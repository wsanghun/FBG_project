<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/mainlayout}">

<div layout:fragment="content">

    <link rel="stylesheet" th:href="@{/css/game-detail.css}">

    <div class="game-detail-container">

        <!-- ================= ì™¼ìª½ ì˜ì—­ ================= -->
        <div class="left-panel">
            <div class="detail-image">
                <img th:src="${game.thumbnail}" onerror="this.src='/image/noimage.png'"/>
            </div>

        </div>
        <!-- ================= ì˜¤ë¥¸ìª½ ì˜ì—­ ================= -->
        <div class="right-panel">

            <!-- ì œëª© + ëª©ë¡ ë²„íŠ¼ -->
            <div class="title-row">
                <h1 class="game-title2" th:text="${game.krName}"></h1>
                <a href="/games" class="back-btn-inline">â† ëª©ë¡ìœ¼ë¡œ</a>
            </div>

            <p class="origin-name" th:text="${game.name}"></p>


            <!-- ì¢‹ì•„ìš” / ì¦ê²¨ì°¾ê¸° -->
            <div class="action-button">
                <button id="likeBtn">ğŸ¤ ì¢‹ì•„ìš”</button>
                <button id="favoriteBtn">â­ ì¦ê²¨ì°¾ê¸°</button>
            </div>

            <!-- ê¸°ë³¸ ì •ë³´ -->
            <div class="info-row">
                <span>ì¶œì‹œë…„ë„</span><strong th:text="${game.year}"></strong>
            </div>
            <div class="info-row">
                <span>ë­í‚¹</span><strong th:text="${game.rank}"></strong>
            </div>

            <!-- ì„¤ëª… -->
            <div class="detail-desc">
                <h3>ê²Œì„ ì„¤ëª…</h3>
                <p th:text="${game.description}"></p>
            </div>
        </div>
    </div>
    <div class="game-detail-container2">

        <!-- ================= ì™¼ìª½ ì˜ì—­ ================= -->
        <div class="left-panel">
            <!-- ê·¸ë˜í”„ -->
            <div class="rating-graph-box">
                <h3 class="usergraph">ìœ ì € í‰ì  ë¶„í¬</h3>

                <div class="rating-bar">
                    <span>10ì </span>
                    <div class="bar"><div class="fill fill-10"></div></div>
                    <span class="count" id="rate10"></span>
                </div>

                <div class="rating-bar">
                    <span>9ì </span>
                    <div class="bar"><div class="fill fill-9"></div></div>
                    <span class="count" id="rate9"></span>
                </div>

                <div class="rating-bar">
                    <span>8ì </span>
                    <div class="bar"><div class="fill fill-8"></div></div>
                    <span class="count" id="rate8"></span>
                </div>
            </div>

            <!-- ì„¤ëª…ì„œ -->
            <div class="manual-section">
                <h3>ê²Œì„ ì„¤ëª…ì„œ</h3>

                <div class="manual-images">
                    <img src="/image/noimage.png">
                    <img src="/image/noimage.png">
                    <img src="/image/noimage.png">
                </div>

                <a href="/files/brass_rulebook.pdf" class="manual-download">
                    ğŸ“¥ ì„¤ëª…ì„œ PDF ë‹¤ìš´ë¡œë“œ
                </a>
            </div>
        </div>


        <!-- ================= ì˜¤ë¥¸ìª½ ì˜ì—­ ================= -->
        <div class="right-panel">
            <!-- âœ… ê·¸ë˜í”„ ì˜¤ë¥¸ìª½ ì¹´ë“œ -->
            <div class="extra-info-box">
                <div class="info-item">
                    <span>â­ í‰ì </span>
                    <strong th:text="${extra.rating}"></strong>
                </div>

                <div class="info-item">
                    <span>ğŸ² ë‚œì´ë„</span>
                    <strong th:text="${extra.weight}"></strong>
                </div>

                <div class="info-item">
                    <span>ğŸ‘¥ ì¸ì›</span>
                    <strong th:text="${extra.minPlayers + '~' + extra.maxPlayers}"></strong>
                </div>

                <div class="info-item">
                    <span>â± í”Œë ˆì´ ì‹œê°„</span>
                    <strong th:text="${extra.playingTime + 'ë¶„'}"></strong>
                </div>

                <div class="info-item full">
                    <span>ğŸ¨ ë””ìì´ë„ˆ</span>
                    <strong th:text="${extra.designers}"></strong>
                </div>

                <div class="info-item full">
                    <span>ğŸ¢ í¼ë¸”ë¦¬ì…”</span>
                    <strong th:text="${extra.publishers}"></strong>
                </div>
            </div>

        </div>



        <!-- âœ… ë¹„ìŠ·í•œ ê²Œì„ (ì´ë¯¸ì§€ ì‹œì‘ ë¼ì¸ ê¸°ì¤€) -->
        <div class="similar-section" th:if="${similarGames.size() > 0}">
            <h3 class="similar-title">ë¹„ìŠ·í•œ ê²Œì„</h3>

            <div class="similar-list">
                <div class="similar-card"
                     th:each="g : ${similarGames}"
                     th:onclick="|location.href='@{/games/{id}(id=${g.id})}'|">
                    <img th:src="${g.thumbnail}">
                    <p th:text="${g.krName != null ? g.krName : g.name}"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {

      const gameId = "[[${game.id}]]";

      // ================= ì¢‹ì•„ìš” =================
      const likeBtn = document.getElementById("likeBtn");

      let likes = JSON.parse(localStorage.getItem("likes") || "[]");

      if (likes.includes(gameId)) {
          likeBtn.innerText = "â¤ï¸ ì¢‹ì•„ìš”ë¨";
      }

      likeBtn.addEventListener("click", () => {
          if (likes.includes(gameId)) {
              likes = likes.filter(id => id !== gameId);
              likeBtn.innerText = "ğŸ¤ ì¢‹ì•„ìš”";
          } else {
              likes.push(gameId);
              likeBtn.innerText = "â¤ï¸ ì¢‹ì•„ìš”ë¨";
          }
          localStorage.setItem("likes", JSON.stringify(likes));
      });

      // ================= ì¦ê²¨ì°¾ê¸° =================
      const favBtn = document.getElementById("favoriteBtn");

      let favorites = JSON.parse(localStorage.getItem("favorites") || "[]");

      if (favorites.includes(gameId)) {
          favBtn.innerText = "âœ… ì¦ê²¨ì°¾ê¸°ë¨";
      }

      favBtn.addEventListener("click", () => {
          if (favorites.includes(gameId)) {
              favorites = favorites.filter(id => id !== gameId);
              favBtn.innerText = "â­ ì¦ê²¨ì°¾ê¸°";
          } else {
              favorites.push(gameId);
              favBtn.innerText = "âœ… ì¦ê²¨ì°¾ê¸°ë¨";
          }
          localStorage.setItem("favorites", JSON.stringify(favorites));
      });

      // ================= ê·¸ë˜í”„ =================
      function randomPercent() {
          return Math.floor(Math.random() * 100);
      }

      const r10 = randomPercent();
      const r9 = randomPercent();
      const r8 = randomPercent();

      document.querySelector(".fill-10").style.width = r10 + "%";
      document.querySelector(".fill-9").style.width = r9 + "%";
      document.querySelector(".fill-8").style.width = r8 + "%";

      document.getElementById("rate10").innerText = r10 + "%";
      document.getElementById("rate9").innerText = r9 + "%";
      document.getElementById("rate8").innerText = r8 + "%";

  });
    </script>
</div>
</html>