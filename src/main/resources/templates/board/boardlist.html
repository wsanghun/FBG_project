<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/mainlayout}">

<div layout:fragment="content">

    <link rel="stylesheet" th:href="@{/css/board-list.css}">

    <!-- 🔥 board-container는 딱 3개의 자식만 있어야 함 -->
    <div class="board-container">

        <!-- 좌측 사이드바 -->
        <aside class="left-sidebar">
            <div class="sidebar-title">게시판</div>
            <ul class="sidebar-menu">
                <li><a href="/board/boardlist?type=free">● 자유게시판</a></li>
                <li><a href="/board/boardlist?type=notice">● 공지사항</a></li>
                <li><a href="/board/boardlist?type=review">● 후기게시판</a></li>
                <li><a href="/board/boardlist?type=qna">● QnA</a></li>
                <li><a href="/board/boardlist?sort=like">● 추천순 모아보기</a></li>
                <li><a href="/board/boardlist?sort=new">● 최신 게시글</a></li>
                <li><a href="/member/myboard">● 내가 쓴 글</a></li>
            </ul>
        </aside>

        <!-- 중앙 게시판 (⚠ 중간에 절대 다른 텍스트/공백/주석 넣지 말 것!) -->
        <div class="board-wrapper">

            <div class="board-header">
                <h2 th:text="${
                    type=='free' ? '자유게시판' :
                    type=='review' ? '후기 게시판' :
                    type=='notice' ? '공지사항' :
                    type=='qna' ? 'QnA 게시판' : '게시판'
                }"></h2>

                <a th:href="@{/board/write(type=${type})}" class="write-btn">글쓰기</a>
            </div>

            <div class="board-list">
                <div class="board-item"
                     th:each="board : ${boardlist.content}"
                     th:onclick="|location.href='@{/board/boardview(idx=${board.idx})}'|">

                    <div class="board-title" th:text="${board.title}"></div>

                    <div class="board-meta">
                        <span th:text="${board.userid}"></span>
                        · 조회 <span th:text="${board.views}"></span>
                        · 👍 <span th:text="${board.likeCount}"></span>
                        · 👎 <span th:text="${board.dislikeCount}"></span>
                        <span th:if="${board.fileCount > 0}">
                            · 🗂 파일 <span th:text="${board.fileCount}"></span>
                        </span>
                    </div>

                </div>
            </div>

            <!-- 페이지네이션 -->
            <div class="pagination"
                 th:with="
                     currentPage=${boardlist.number + 1},
                     totalPages=${boardlist.totalPages},
                     pageGroupSize=10,
                     startPage=${(currentPage - 1) / pageGroupSize * pageGroupSize + 1},
                     endPage=${totalPages > 0 ? ((startPage + pageGroupSize - 1 < totalPages) ? startPage + pageGroupSize - 1 : totalPages) : 1}
                 ">
                <a class="pg-btn"
                   th:if="${!boardlist.first}"
                   th:href="@{/board/boardlist(page=${boardlist.number - 1}, type=${type})}">이전</a>

                <a class="pg-num"
                   th:each="num : ${#numbers.sequence(startPage, endPage)}"
                   th:text="${num}"
                   th:classappend="${num == currentPage ? 'active' : ''}"
                   th:href="@{/board/boardlist(page=${num - 1}, type=${type})}"></a>

                <a class="pg-btn"
                   th:if="${!boardlist.last}"
                   th:href="@{/board/boardlist(page=${boardlist.number + 1}, type=${type})}">다음</a>
            </div>

            <!-- 검색 -->
            <form class="board-search-box" method="get" action="/board/boardlist">
                <input type="hidden" name="type" th:value="${type}">
                <select name="key" class="board-search-select">
                    <option value="title">제목</option>
                    <option value="content">내용</option>
                    <option value="id">아이디</option>
                </select>
                <input class="board-search-input" type="text" name="word" th:value="${word}">
                <button class="board-search-btn">검색</button>
            </form>

        </div>

        <!-- 우측 사이드바 -->
        <aside class="right-sidebar">

            <div class="sidebar-title">🔥 인기 검색어</div>

            <ol class="popular-search-list">
                <li th:each="s, stat : ${popularSearchList}">

                    <!-- 1위 스타일 -->
                    <a th:if="${stat.index == 0}"
                       th:href="@{/search(keyword=${s.keyword})}"
                       th:text="'🔥 ' + ${s.keyword} "
                       style="color:#e53935; font-weight:700; font-size:17px;">
                    </a>

                    <!-- 2위 스타일 -->
                    <a th:if="${stat.index == 1}"
                       th:href="@{/search(keyword=${s.keyword})}"
                       th:text="'⭐ ' + ${s.keyword} "
                       style="color:#fb8c00; font-weight:600;">
                    </a>

                    <!-- 3위 이하 -->
                    <a th:if="${stat.index > 1}"
                       th:href="@{/search(keyword=${s.keyword})}"
                       th:text="${s.keyword}">
                    </a>

                </li>
            </ol>

        </aside>

    </div>

</div>
</html>
