<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/mainlayout}">

<div layout:fragment="content">

  <style>
    body {
        background-image: url("/image/bgimage.jpg");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        background-attachment: fixed;
        min-height: 100vh;
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        display: flex;
        flex-direction: column;
    }

    .editor-container textarea {
        min-height: 400px;
    }
  </style>

  <div class="page-container">

    <!-- ================= 왼쪽 영역 ================= -->
    <div class="writing-area">
      <div class="writing-header">
        <h2>게시글 등록</h2>
      </div>

      <form th:action="@{/boardmodify_proc}"
            th:object="${board}"
            method="post"
            enctype="multipart/form-data">

        <!-- 게시글 PK -->
        <input type="hidden" th:field="*{idx}" />

        <!-- ✅ 게시판 선택 (form 안으로 이동) -->
        <div class="board-select mt-3">
          <label for="type">게시판 선택</label>
          <select th:field="*{type}" id="type" class="form-select">
            <option value="free">자유게시판</option>
            <option value="notice">공지사항</option>
            <option value="review">후기</option>
            <option value="qna">질문게시판</option>
          </select>
        </div>

        <!-- 제목 -->
        <input type="text"
               th:field="*{title}"
               class="title-input"
               required
               placeholder="제목" />

        <!-- 내용 -->
        <textarea id="content"
                  th:field="*{content}"
                  class="content-textarea"
                  required></textarea>

        <!-- 파일 -->
        <div class="file-attachments mt-4">
          <h4>첨부 파일</h4>
          <input type="file" name="upfile" class="form-control">
        </div>

        <!-- 버튼 -->
        <div class="action-buttons mt-4">
          <button type="button" class="btn-secondary-custom">저장</button>
          <button type="submit" class="btn-primary-custom">수정 완료</button>
        </div>

      </form>

    </div>

    <!-- ================= 우측 가이드 ================= -->
    <div class="guide-sidebar">
      <h3>커뮤니티 규칙 준수</h3>
      <ul>
        <li>게시글은 예의범절을 지켜주세요.</li>
        <li>작성자는 글에 대한 불이익을 받을 수 있어요.</li>
      </ul>

      <h3>작성 가이드</h3>
      <ul>
        <li>자전거 거래 시 바람 주의.</li>
        <li>사용자명은 자유롭게.</li>
        <li>위치는 최대 2곳.</li>
      </ul>

      <h3>게임 태그</h3>
      <ul>
        <li>게임 구매자에게 피드 전송.</li>
      </ul>

      <h3>게시판 선택</h3>
      <ul>
        <li>게시판은 수정 불가.</li>
      </ul>
    </div>
  </div>
</div>

<!-- ================= 스크립트 영역 ================= -->
<th:block layout:fragment="script">

  <!-- CKEditor CDN -->
  <script src="https://cdn.ckeditor.com/ckeditor5/35.4.0/classic/ckeditor.js"></script>
  <script src="https://cdn.ckeditor.com/ckeditor5/35.4.0/classic/translations/ko.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@ckeditor/ckeditor5-upload@35.4.0/build/base64uploadadapter.js"></script>

  <!-- CKEditor 초기화 -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {

        ClassicEditor.create(document.querySelector('#content'), {
            language: "ko",

            ckfinder: {
                uploadUrl: "/upload/image"
            },

            htmlSupport: {
                allow: [{
                    name: /.*/,
                    attributes: true,
                    classes: true,
                    styles: true
                }]
            },

            toolbar: {
                items: [
                    'undo','redo',
                    '|','heading',
                    '|','bold','italic','underline','strikethrough',
                    '|','fontSize','fontFamily','fontColor','fontBackgroundColor',
                    '|','alignment',
                    '|','bulletedList','numberedList','blockQuote',
                    '|','link','imageUpload','insertTable'
                ]
            },

            image: {
                toolbar: [
                    'imageTextAlternative',
                    'toggleImageCaption',
                    'imageStyle:inline',
                    'imageStyle:block',
                    'imageStyle:side',
                    'resizeImage'
                ],
                styles: ['inline','block','side'],
                resizeOptions: [
                    { name: 'resizeImage:original', label: '100%', value: null },
                    { name: 'resizeImage:50', label: '50%', value: '50' },
                    { name: 'resizeImage:75', label: '75%', value: '75' }
                ]
            }

        }).catch(err => {
            console.error("수정 페이지 에디터 에러:", err);
        });
    });
  </script>

</th:block>
</html>