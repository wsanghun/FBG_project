<header class="main-header" th:fragment="header"
        xmlns:th="http://www.thymeleaf.org"
        xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
          crossorigin="anonymous"/>

    <div class="header-main-top-bar">
        <div class="top-bar-container">

            <!-- Î°úÍ≥† -->
            <a th:href="@{/}" class="logo-area-link">
                <div class="logo-area">
                    <img th:src="@{/image/logo.png}" alt="Find Board Game Logo" class="logo-img">
                </div>
            </a>

            <!-- Í≤ÄÏÉâ ÏòÅÏó≠ -->
            <div class="search-and-advanced">

                <div class="search-box-wrap">
                    <div class="search-box">
                        <form id="headerSearchForm" th:action="@{/search}" method="get" class="search-form">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" name="keyword" id="headerKeyword" placeholder="ÌÜµÌï©Í≤ÄÏÉâ">
                        </form>
                    </div>
                </div>

                <!-- üî• Í≤ÄÏÉâ Î≤ÑÌäº (Í≥†Í∏âÍ≤ÄÏÉâ ‚Üí Í≤ÄÏÉâ Î≤ÑÌäºÏúºÎ°ú Î≥ÄÍ≤Ω) -->
                <button class="btn btn-orange" id="searchSubmitBtn">Í≤ÄÏÉâ</button>
            </div>

            <!-- Ïú†Ï†Ä Î©îÎâ¥ -->
            <div class="user-actions">

                <!-- Î°úÍ∑∏Ïù∏ Ï†Ñ -->
                <th:block sec:authorize="!isAuthenticated()">
                    <a th:href="@{/user/join}" class="btn btn-blue">ÌöåÏõêÍ∞ÄÏûÖ</a>
                    <a th:href="@{/login}" class="btn btn-blue">Î°úÍ∑∏Ïù∏</a>
                </th:block>

                <!-- Î°úÍ∑∏Ïù∏ ÌõÑ -->
                <th:block sec:authorize="isAuthenticated()">
                    <a th:href="@{/board/write}" class="btn btn-orange">Í∏ÄÏì∞Í∏∞</a>

                    <!-- üîî ÏïåÎ¶º -->
                    <div class="notification-wrapper">

                        <!-- ÏïåÎ¶º Î≤ÑÌäº -->
                        <a id="notificationBtn" class="user-menu-item notification-btn">
                            <i class="far fa-bell"></i>

                            <!-- ÏùΩÏßÄ ÏïäÏùÄ ÏïåÎ¶ºÏù¥ ÏûàÏùÑ ÎïåÎßå Ïà´Ïûê ÌëúÏãú -->
                            <span class="notification-badge"
                                  th:if="${notificationCount > 0}"
                                  th:text="${notificationCount}"></span>
                        </a>

                        <!-- ÎìúÎ°≠Îã§Ïö¥ -->
                        <div class="notification-dropdown" id="notificationDropdown">

                            <!-- ÏïåÎ¶º ÏóÜÏùå -->
                            <div class="notice-empty"
                                 th:if="${notificationList == null or #lists.isEmpty(notificationList)}">
                                üì≠ ÏïåÎ¶ºÏù¥ ÏóÜÏäµÎãàÎã§.
                            </div>

                            <!-- ÏïåÎ¶º Î™©Î°ù -->
                            <div class="notice-item"
                                 th:each="n : ${notificationList}">
                                <a th:href="@{/notifications/read(id=${n.id})}">
                                    <div class="notice-text" th:text="${n.message}"></div>
                                    <div class="notice-date"
                                         th:text="${#dates.format(n.createdAt, 'yyyy-MM-dd HH:mm')}"></div>
                                </a>
                            </div>

                        </div>
                    </div>


                    <!-- ÌîÑÎ°úÌïÑ -->
                    <div class="user-profile-menu-container">
                        <a id="profile-dropdown-btn" class="user-menu-item profile-link">

                            <img class="profile-img"
                                 th:if="${#authentication.principal.profileImage != null}"
                                 th:src="${#authentication.principal.profileImage}"/>

                            <span th:if="${#authentication.principal.profileImage == null}"
                                  class="profile-icon"
                                  th:text="${#strings.substring(#authentication.name, 0, 1)}"></span>

                            <span class="user-id" th:text="${#authentication.name}"></span>
                            <i class="fas fa-caret-down dropdown-arrow"></i>
                        </a>

                        <div id="profile-dropdown-content" class="dropdown-content">
                            <a th:href="@{/user/view(idx=${#authentication.principal.memberEntity.idx})}">
                                ÎÇ¥ Ï†ïÎ≥¥
                            </a>
                            <a th:href="@{/mypage/articles}">ÎÇ¥ Í∏Ä</a>
                            <a th:href="@{/settings}">ÏÑ§Ï†ï</a>
                            <form th:action="@{/logout}" method="post">
                                <button type="submit" class="dropdown-logout-btn">Î°úÍ∑∏ÏïÑÏõÉ</button>
                            </form>
                        </div>
                    </div>
                </th:block>

            </div>
        </div>
    </div>

    <!-- ‚ñº ÌïòÎã® ÎÑ§ÎπÑ -->
    <div class="header-menu-bottom-bar">
        <div class="bottom-menu-container">

            <!-- Î™®Î∞îÏùº ÌñÑÎ≤ÑÍ±∞ -->
            <i class="fas fa-bars menu-icon" id="mobileMenuBtn"></i>

            <!-- Îç∞Ïä§ÌÅ¨ÌÜ± Î©îÎâ¥ -->
            <nav class="header-menu-bottom desktop-menu">
                <a th:href="@{/board/boardlist(type='free')}">ÏûêÏú†Í≤åÏãúÌåê</a>
                <a th:href="@{/board/boardlist(type='notice')}">Í≥µÏßÄÏÇ¨Ìï≠</a>
                <a th:href="@{/board/boardlist(type='review')}">ÌõÑÍ∏∞</a>
                <a th:href="@{/board/boardlist(type='qna')}">ÏßàÎ¨∏Í≤åÏãúÌåê</a>
            </nav>

            <!-- Î™®Î∞îÏùº ÎÑ§ÎπÑ -->
            <div id="mobileNavDropdown" class="mobile-nav-dropdown">
                <a th:href="@{/board/boardlist(type='free')}">ÏûêÏú†Í≤åÏãúÌåê</a>
                <a th:href="@{/board/boardlist(type='notice')}">Í≥µÏßÄÏÇ¨Ìï≠</a>
                <a th:href="@{/board/boardlist(type='review')}">ÌõÑÍ∏∞</a>
                <a th:href="@{/board/boardlist(type='qna')}">ÏßàÎ¨∏Í≤åÏãúÌåê</a>
            </div>

        </div>
    </div>

    <!-- JS -->
    <script>
        const mobileBtn = document.getElementById("mobileMenuBtn");
        const mobileNav = document.getElementById("mobileNavDropdown");

        document.getElementById("searchSubmitBtn").addEventListener("click", () => {
            document.getElementById("headerSearchForm").submit();
        });

        mobileBtn.addEventListener("click", () => {
            mobileNav.classList.toggle("open");
        });

        /* üî• DOM Î°úÎî© ÌõÑ Ïã§Ìñâ (Îî± 1Î≤àÎßå!) */
        document.addEventListener('DOMContentLoaded', function() {

            /* ===================== ÌîÑÎ°úÌïÑ ÎìúÎ°≠Îã§Ïö¥ ===================== */
            const btn = document.getElementById('profile-dropdown-btn');
            const content = document.getElementById('profile-dropdown-content');

            if (btn && content) {
                btn.addEventListener('click', function(event) {
                    event.preventDefault();
                    event.stopPropagation();
                    content.style.display = content.style.display === 'block' ? 'none' : 'block';
                });

                window.addEventListener('click', function(event) {
                    if (!btn.contains(event.target) && !content.contains(event.target)) {
                        content.style.display = 'none';
                    }
                });
            }

            /* ===================== üîî ÏïåÎ¶º ÎìúÎ°≠Îã§Ïö¥ ===================== */
            const notificationBtn = document.getElementById("notificationBtn");
            const notificationDropdown = document.getElementById("notificationDropdown");

            if (notificationBtn && notificationDropdown) {

                notificationBtn.addEventListener("click", (event) => {
                    event.preventDefault();
                    event.stopPropagation();

                    notificationDropdown.classList.toggle("open");
                });

                document.addEventListener("click", () => {
                    notificationDropdown.classList.remove("open");
                });
            }

        });
    </script>

</header>
