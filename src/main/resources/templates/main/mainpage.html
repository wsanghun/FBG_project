<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/mainlayout}">

<th:block layout:fragment="content" th:with="pageType='home'">
    <style>
        body {
            /*bgimage.png ÌååÏùº Í≤ΩÎ°ú: /image/bgimage.png */
            /*background-image: url("/image/bgimage.jpg");*/
            background-size: cover;          /* ÌôîÎ©¥ÏùÑ ÍΩâ Ï±ÑÏö∞ÎèÑÎ°ù ÏÑ§Ï†ï */
            background-position: center;     /* Ïù¥ÎØ∏ÏßÄÎ•º Ï§ëÏïôÏóê Î∞∞Ïπò */
            background-repeat: no-repeat;
            background-attachment: fixed;
            min-height: 100vh;
            margin: 0;
            font-family: sans-serif;
        }
    </style>

    <div class="main-content-container">
        <li class="diary-link">
            <a href="https://www.notion.so/2a487806361780788fcaf3a1841b2675?v=2a48780636178030aed6000c47a46397"
               target="_blank" rel="noopener noreferrer">ÏùºÏßÄ ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô</a>
        </li>

        <!-- Ïã§ÏãúÍ∞Ñ Î≤†Ïä§Ìä∏ Í≤åÏûÑ ÏòÅÏó≠ -->
        <div class="hot-section">
            <div class="section-header">
                <h2>üî• Î≤†Ïä§Ìä∏ Í≤åÏûÑ</h2>
                <a href="/games" class="more-link">Ï†ÑÏ≤¥Î≥¥Í∏∞ ‚Ä∫</a>
            </div>

            <div class="hot-slider" id="hotSlider">

                <a class="hot-card"
                   th:each="game, iter : ${hotGames}"
                   th:href="@{/games/{id}(id=${game.id})}">

                    <!-- ÏàúÏúÑ Ïà´Ïûê -->
                    <span class="rank-number" th:text="${iter.index + 1}">1</span>

                    <!-- Ïù¥ÎØ∏ÏßÄ -->
                    <img th:src="${game.thumbnail}"
                         onerror="this.onerror=null; this.src='/image/noimage.png';"
                         class="hot-img">

                    <!-- Ï†úÎ™© (ÌïúÍµ≠Ïñ¥ Ïö∞ÏÑ†) -->
                    <div class="game-title"
                         th:text="${game.krName != null ? game.krName : game.name}">
                        Game Name
                    </div>

                </a>

            </div>
        </div>


        <div class="list-sections-container">

            <!-- ÏôºÏ™Ω -->
            <div class="left-section">

                <!-- ÏµúÏã†Í∏Ä -->
                <div class="main-list-section">
                    <div class="section-header-line">
                        <h3>ÏµúÏã† Í≤åÏãúÍ∏Ä</h3>
                        <a href="/board/allboard?mode=latest" class="more-btn">ÎçîÎ≥¥Í∏∞ ‚Ä∫</a>
                    </div>

                    <ul>
                        <li th:each="board, stat : ${latestList}" th:if="${stat.index < 4}">
                            <div class="latest-item-header">

                                <a th:href="@{/board/boardview(idx=${board.idx})}"
                                   th:text="${board.title}"></a>

                                <!-- üî• Í∏Ä ÌÉÄÏûÖ Î±ÉÏßÄ Ï∂îÍ∞Ä! ÌÅ¥Î¶≠ÌïòÎ©¥ Ìï¥Îãπ Í≤åÏãúÌåê Î™©Î°ùÏúºÎ°ú Ïù¥Îèô -->
                                <a th:href="@{/board/boardlist(type=${board.type})}">
                                    <span class="board-type-badge"
                                          th:classappend="${board.type}">
                                        <span th:text="${board.type.toUpperCase()}"></span>
                                    </span>
                                </a>

                            </div>

                            <div class="latest-meta">
                                <span th:text="${board.userid}"></span>
                                ¬∑
                                <span th:text="${board.views} + ' Ï°∞Ìöå'"></span>
                            </div>
                        </li>
                    </ul>
                </div>

            </div>

            <!-- Ïò§Î•∏Ï™Ω -->
            <div class="right-section">

                <div class="main-list-section">
                    <div class="section-header-line">
                        <h3>Í≥µÏßÄÏÇ¨Ìï≠</h3>
                        <a href="/board/boardlist?type=notice" class="more-btn">ÎçîÎ≥¥Í∏∞ ‚Ä∫</a>
                    </div>

                    <ul>
                        <li th:each="board, stat : ${noticeList}" th:if="${stat.index < 4}">
                            <a th:href="@{/board/boardview(idx=${board.idx})}"
                               th:text="${board.title}"></a>

                            <div>
                                <span th:text="${#dates.format(board.regdate, 'MM-dd')}"></span>
                            </div>
                        </li>
                    </ul>
                </div>

            </div>
        </div>


        <div class="section-header">
            <h2>Ïù∏Í∏∞ Í∏Ä</h2>
            <a href="/board/allboard?mode=popular" class="more-link">Ï†ÑÏ≤¥Î≥¥Í∏∞ ‚Ä∫</a>
        </div>

        <div class="masonry-wrapper">
            <div class="masonry-board">

                <!-- üî• masonry-cardÍ∞Ä Ïó¨Í∏∞ÏÑú Î∞òÎ≥µÎêòÏñ¥Ïïº ÌïúÎã§ -->
                <div th:each="board : ${popularList}">
                    <div class="masonry-card">

                        <a th:href="@{/board/boardview(idx=${board.idx})}"
                           class="masonry-title"
                           th:text="${board.title}"></a>

                        <div class="masonry-meta">
                            <span th:text="${board.userid}"></span>
                            ¬∑ Ï°∞Ìöå <span th:text="${board.views}"></span>
                            ¬∑ Ï∂îÏ≤ú <span th:text="${board.likeCount}"></span>
                        </div>

                        <div class="hidden-content" th:utext="${board.content}" style="display:none;"></div>

                        <img class="masonry-img" style="display:block;" />
                    </div>
                </div>

            </div>
        </div>


    </div>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
        // --- Í∏∞Ï°¥ BEST1,2,3 ÏóÖÎç∞Ïù¥Ìä∏ Î°úÏßÅ ---
        fetch("/boardgame/top")
            .then(res => res.json())
            .then(data => {
                document.getElementById("best1").innerText = data[0].name;
                document.getElementById("best2").innerText = data[1].name;
                document.getElementById("best3").innerText = data[2].name;
            });

        // --- HOT Ïä¨ÎùºÏù¥Îçî ÏûêÎèô Ïä§ÌÅ¨Î°§ ---
    const slider = document.getElementById("hotSlider");
    if (!slider) return;

    // üî• Î¨¥Ìïú Î£®ÌîÑ ÎßåÎì§Í∏∞
    const originalCards = [...slider.querySelectorAll(".hot-card")];
    originalCards.forEach(card => slider.appendChild(card.cloneNode(true)));

    // ÏÑ§Ï†ïÍ∞í
    let autoScrollSpeed = 0.5;
    let isAutoScroll = true;
    let dragStartX = 0;
    let dragScrollLeft = 0;
    let isDragging = false;
    let restartTimer = null;

    // üî• ÏûêÎèô Ïä¨ÎùºÏù¥Îìú Ïû¨ÏãúÏûë ÌÉÄÏù¥Î®∏
    const restartAutoScroll = () => {
        clearTimeout(restartTimer);
        restartTimer = setTimeout(() => {
            isAutoScroll = true;
        }, 1500);
    };

    // ÎìúÎûòÍ∑∏ ÏãúÏûë
    const startDrag = (e) => {
        isAutoScroll = false;
        isDragging = true;
        slider.classList.add("dragging");

        dragStartX = e.pageX || e.touches[0].pageX;
        dragScrollLeft = slider.scrollLeft;

        clearTimeout(restartTimer);
    };

    // ÎìúÎûòÍ∑∏ Ï§ë
    const duringDrag = (e) => {
        if (!isDragging) return;

        const x = e.pageX || e.touches[0].pageX;
        slider.scrollLeft = dragScrollLeft - (x - dragStartX);
    };

    // ÎìúÎûòÍ∑∏ ÎÅù
    const endDrag = () => {
        isDragging = false;
        slider.classList.remove("dragging");
        restartAutoScroll();
    };

    // üî• Ìú†Î°ú Ï¢åÏö∞ Ïù¥Îèô
    slider.addEventListener("wheel", (e) => {
        e.preventDefault();
        isAutoScroll = false;

        slider.scrollLeft += e.deltaY * 0.8;  // ÏûêÏó∞Ïä§Îü¨Ïö¥ Ìú† Ïù¥Îèô

        restartAutoScroll(); // 1.5Ï¥à Îí§ ÏûêÎèô Ïä¨ÎùºÏù¥Îìú Ïû¨Í∞ú
    }, { passive: false });

    // ÎßàÏö∞Ïä§ Ïò¨Î¶º ‚Üí ÏûêÎèô Î©àÏ∂§
    slider.addEventListener("mouseenter", () => {
        isAutoScroll = false;
    });

    // ÎßàÏö∞Ïä§ ÎÇòÍ∞ê ‚Üí 1.5Ï¥à Îí§ ÏûêÎèô Ïû¨Í∞ú
    slider.addEventListener("mouseleave", () => {
        restartAutoScroll();
    });

    // ÎìúÎûòÍ∑∏ Ïù¥Î≤§Ìä∏
    slider.addEventListener("mousedown", startDrag);
    window.addEventListener("mousemove", duringDrag);
    window.addEventListener("mouseup", endDrag);

    slider.addEventListener("touchstart", startDrag);
    window.addEventListener("touchmove", duringDrag);
    window.addEventListener("touchend", endDrag);

    // üî• ÏûêÎèô Ïä¨ÎùºÏù¥Îìú Ïï†ÎãàÎ©îÏù¥ÏÖò
    const animate = () => {
        if (isAutoScroll && !isDragging) {
            slider.scrollLeft += autoScrollSpeed;
        }

        // Î¨¥Ìïú Î£®ÌîÑ Ï≤òÎ¶¨
        const maxScroll = slider.scrollWidth / 2;
        if (slider.scrollLeft >= maxScroll) {
            slider.scrollLeft = 0;
        }

        requestAnimationFrame(animate);
    };

    animate();

      /* ==============================
       ‚úÖ Í≤åÏãúÍ∏Ä Ïù¥ÎØ∏ÏßÄ ÏûêÎèô Ï∂îÏ∂ú (Masonry ÏòÅÏó≠)
    ============================== */
    document.querySelectorAll(".masonry-card").forEach(card => {
        const contentDiv = card.querySelector(".hidden-content");
        const imgTag = card.querySelector(".masonry-img");

        if (!contentDiv || !imgTag) return;

        const temp = document.createElement("div");
        temp.innerHTML = contentDiv.innerHTML;

        const img = temp.querySelector("img");

        if (img && img.src) {
            imgTag.src = img.src;
            imgTag.style.display = "block";
        }
    });

    });
    </script>
</th:block>
</html>