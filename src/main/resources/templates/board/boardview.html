<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/mainlayout}">

<div layout:fragment="content">
    <link rel="stylesheet" th:href="@{/css/Style.css}">
    <style>
        body {
            /*bgimage.png íŒŒì¼ ê²½ë¡œ: /image/bgimage.png */

            background-size: cover;          /* í™”ë©´ì„ ê½‰ ì±„ìš°ë„ë¡ ì„¤ì • */
            background-position: center;     /* ì´ë¯¸ì§€ë¥¼ ì¤‘ì•™ì— ë°°ì¹˜ */
            background-repeat: no-repeat;
            background-attachment: fixed;
            min-height: 100vh;
            margin: 0;
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
        }
    </style>
    <div class="view-container">

        <div th:if="${board != null}">

            <div class="view-group">

                <div class="view-title-row">
                    <div class="view-title" th:text="${board.title}"></div>
                    <div class="board-type-badge"
                         th:text="${board.type.toUpperCase()}"
                         th:classappend="${board.type}"></div>
                </div>

                <div class="view-info">
                    <span th:text="|ì‘ì„±ì: ${board.userid}|">ì‘ì„±ì: user1</span>
                    <span th:text="|ì‘ì„±ì¼: ${board.regdate != null ? #dates.format(board.regdate, 'yyyy-MM-dd HH:mm') : 'ë‚ ì§œ ì •ë³´ ì—†ìŒ'}|">ì‘ì„±ì¼: 2025-10-21 13:00</span>
                </div>
            </div>

            <div class="view-content">

                <!--<th:block th:if="${fileInfo != null and fileInfo.newfilename != null}">

                    <th:block th:if="${fileInfo.newfilename.toLowerCase().endsWith('.jpg') or
                                       fileInfo.newfilename.toLowerCase().endsWith('.jpeg') or
                                       fileInfo.newfilename.toLowerCase().endsWith('.png') or
                                       fileInfo.newfilename.toLowerCase().endsWith('.gif')}">

                        <img th:src="@{/image/display(fileIdx=${fileInfo.idx})}" alt="ì²¨ë¶€ ì´ë¯¸ì§€"
                             style="max-width: 100%; height: auto; display: block; border: 1px solid #eee;"/>
                    </th:block>
                </th:block>-->

                <p th:utext="${board.content}"></p>
            </div>

           <!-- <div class="view-file" th:if="${fileInfo != null}">
                ì²¨ë¶€íŒŒì¼:
                &lt;!&ndash;<a th:href="@{/board/download(fileIdx=${fileInfo.idx})}" th:text="${fileInfo.upfile}">ì²¨ë¶€íŒŒì¼_ì´ë¦„.zip</a>&ndash;&gt;
            </div>-->

            <!-- ë¡œê·¸ì¸í•œ íšŒì›ì˜ member_idx -->
            <input type="hidden" id="current-user-id" th:value="${currentUserId}">
            <div class="like-section">

                <button class="like-btn" id="like-btn" onclick="toggleLike('like')">
                    ğŸ‘ <span  id="like-count" th:text="${board.likeCount}"></span>
                </button>

                <button class="dislike-btn" id="dislike-btn" onclick="toggleLike('dislike')">
                    ğŸ‘ <span id="dislike-count" th:text="${board.dislikeCount}"></span>
                </button>

            </div>

            <div class="button-group">
                <a th:href="@{/board/boardlist}">
                    <button type="button" class="btn-list">ëª©ë¡</button>
                </a>

                <th:block th:if="${board.userid == currentUserId}">
                    <!-- ìˆ˜ì • ë²„íŠ¼ -->
                    <a th:href="@{/board/boardmodify(idx=${board.idx})}">
                        <button type="button" class="btn-modify">ìˆ˜ì •</button>
                    </a>

                    <!-- ì‚­ì œ í¼ ë° ë²„íŠ¼ -->
                    <form th:action="@{/board/delete}" method="post" style="display:inline;" onsubmit="return confirm('ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                        <input type="hidden" name="idx" th:value="${board.idx}" />
                        <button type="submit" class="btn-delete">ì‚­ì œ</button>
                    </form>
                </th:block>
            </div>

            <div class="comment-section">
                <h3>ëŒ“ê¸€</h3>

                <!-- ëŒ“ê¸€ ì‘ì„± í¼ -->
                <div class="comment-form">
                    <form id="comment-post-form" action="javascript:void(0);">
                        <input type="hidden" name="boardIdx" th:value="${board.idx}" />
                        <input type="hidden" name="userId" th:value="${currentUserId}" id="current-user-id-input"/>
                        <textarea name="ment" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..." required></textarea>
                        <button type="submit">ë“±ë¡</button>
                        <div style="clear: both;"></div>
                    </form>
                </div>

                <div id="comment-list-container" class="comment-list">
                    <div class="text-center" style="color: #757575; padding: 15px;">
                        <p>ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                    </div>
                </div>

            </div>

        </div>

        <div th:if="${board == null}" class="text-center">
            <p>í•´ë‹¹ ê²Œì‹œê¸€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
            <a th:href="@{/board/boardlist}"><button type="button" class="btn-list">ëª©ë¡ìœ¼ë¡œ</button></a>
        </div>
    </div>
    <script th:inline="javascript">
        /*<![CDATA[*/
        const BOARD_ID = [[${board.idx}]];
        const CURRENT_USER_ID = [[${currentUserId}]];
        const COMMENT_API_URL = '/api/coments';
        const MEMBER_IDX = [[${currentMemberIdx}]];
        /*]]>*/
    </script>

    <script th:src="@{/json/boardview.js}"></script>
 </div>
</html>